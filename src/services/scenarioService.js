import { generateCompletion } from '../config/openai.js';
import {
   THEMATIC_EVENT_PROMPT,
   EXTRACURRICULAR_EVENT_PROMPT,
   EDUCATIONAL_PROJECT_PROMPT
} from '../prompts/scenarioPrompts.js';
import {
   THEMATIC_EVENT_SYSTEM_PROMPT,
   EXTRACURRICULAR_EVENT_SYSTEM_PROMPT,
   EDUCATIONAL_PROJECT_SYSTEM_PROMPT
} from '../prompts/systemPrompts.js';
import { SCENARIO_SETTINGS } from '../config/promptSettings.js';

/**
 * Генерирует сценарий тематического мероприятия
 * @param {string} topic - Тема мероприятия
 * @param {Object} settings - Настройки мероприятия
 * @param {number} settings.duration - Длительность в минутах
 * @param {string} settings.participantsCount - Количество участников
 * @param {string} settings.age - Возрастная группа
 * @returns {Promise<string>} Сценарий мероприятия
 * @throws {Error} Если не удалось сгенерировать сценарий
 */
export async function generateThematicEvent(topic, settings) {
   try {
      const response = await generateCompletion(THEMATIC_EVENT_PROMPT(topic, settings), {
         ...SCENARIO_SETTINGS.thematicEvent,
         systemPrompt: THEMATIC_EVENT_SYSTEM_PROMPT
      });

      return response;
   } catch (error) {
      console.error('Error in generateThematicEvent:', error);
      throw new Error('Не удалось сгенерировать сценарий мероприятия. Пожалуйста, попробуйте еще раз.');
   }
}

/**
 * Генерирует сценарий внеурочного мероприятия
 * @param {string} topic - Тема мероприятия
 * @param {Object} settings - Настройки мероприятия
 * @param {number} settings.duration - Длительность в минутах
 * @param {string} settings.participantsCount - Количество участников
 * @param {string} settings.age - Возрастная группа
 * @returns {Promise<string>} Сценарий внеурочного мероприятия
 * @throws {Error} Если не удалось сгенерировать сценарий
 */
export async function generateExtracurricularEvent(topic, settings) {
   try {
      const response = await generateCompletion(EXTRACURRICULAR_EVENT_PROMPT(topic, settings), {
         ...SCENARIO_SETTINGS.extracurricularEvent,
         systemPrompt: EXTRACURRICULAR_EVENT_SYSTEM_PROMPT
      });

      return response;
   } catch (error) {
      console.error('Error in generateExtracurricularEvent:', error);
      throw new Error('Не удалось сгенерировать сценарий внеурочного мероприятия. Пожалуйста, попробуйте еще раз.');
   }
}

/**
 * Генерирует сценарий образовательного проекта
 * @param {string} topic - Тема проекта
 * @param {Object} settings - Настройки проекта
 * @param {number} settings.duration - Длительность в минутах
 * @param {string} settings.participantsCount - Количество участников
 * @param {string} settings.age - Возрастная группа
 * @returns {Promise<string>} Сценарий образовательного проекта
 * @throws {Error} Если не удалось сгенерировать сценарий
 */
export async function generateEducationalProject(topic, settings) {
   try {
      const response = await generateCompletion(EDUCATIONAL_PROJECT_PROMPT(topic, settings), {
         ...SCENARIO_SETTINGS.educationalProject,
         systemPrompt: EDUCATIONAL_PROJECT_SYSTEM_PROMPT
      });

      return response;
   } catch (error) {
      console.error('Error in generateEducationalProject:', error);
      throw new Error('Не удалось сгенерировать сценарий образовательного проекта. Пожалуйста, попробуйте еще раз.');
   }
}

// Вспомогательные функции для структур мероприятий
/**
 * Возвращает рекомендуемую структуру мероприятия в зависимости от длительности
 * @param {number} duration - Длительность мероприятия в минутах
 * @returns {string} Структура мероприятия в текстовом формате
 */
export function getEventStructureGuidelines(duration) {
   const durationNum = Number(duration);

   if (durationNum <= 30) {
      return `1. Вводная часть (5 минут):
   - Приветствие
   - Объяснение правил
   - Мотивационный момент

2. Основная часть (20 минут):
   - Ключевая активность
   - Интерактивное взаимодействие

3. Заключительная часть (5 минут):
   - Подведение итогов
   - Рефлексия`;
   }

   if (durationNum <= 45) {
      return `1. Вводная часть (7 минут):
   - Приветствие
   - Объяснение правил
   - Мотивационный момент
   - Разминка

2. Основная часть (30 минут):
   - Первая активность (15 минут)
   - Вторая активность (15 минут)

3. Заключительная часть (8 минут):
   - Подведение итогов
   - Рефлексия
   - Обратная связь`;
   }

   if (durationNum <= 60) {
      return `1. Вводная часть (10 минут):
   - Приветствие
   - Объяснение правил
   - Мотивационный момент
   - Разминка
   - Командообразование

2. Основная часть (40 минут):
   - Первая активность (15 минут)
   - Перерыв/динамическая пауза (5 минут)
   - Вторая активность (20 минут)

3. Заключительная часть (10 минут):
   - Подведение итогов
   - Рефлексия
   - Обратная связь
   - Награждение/поощрение`;
   }

   return `1. Вводная часть (15 минут):
   - Приветствие
   - Объяснение правил
   - Мотивационный момент
   - Разминка
   - Командообразование
   - Постановка целей

2. Основная часть (60 минут):
   - Первая активность (20 минут)
   - Перерыв/динамическая пауза (10 минут)
   - Вторая активность (15 минут)
   - Творческое задание (15 минут)

3. Заключительная часть (15 минут):
   - Презентация результатов
   - Подведение итогов
   - Рефлексия
   - Обратная связь
   - Награждение/поощрение`;
}

/**
 * Возвращает структуру творческого мероприятия в зависимости от длительности
 * @param {number} duration - Длительность мероприятия в минутах
 * @returns {string} Структура творческого мероприятия в текстовом формате
 */
export function getCreativeEventStructure(duration) {
   const durationNum = Number(duration);

   if (durationNum <= 30) {
      return `1. Творческая разминка (5 минут):
   - Раскрепощающие упражнения
   - Настрой на творчество

2. Основной творческий процесс (20 минут):
   - Индивидуальная или групповая работа
   - Создание творческого продукта

3. Презентация (5 минут):
   - Представление работ
   - Обмен впечатлениями`;
   }

   if (durationNum <= 45) {
      return `1. Творческая разминка (10 минут):
   - Раскрепощающие упражнения
   - Настрой на творчество
   - Групповая импровизация

2. Основной творческий процесс (25 минут):
   - Индивидуальная работа
   - Парная или групповая работа
   - Создание творческого продукта

3. Презентация и рефлексия (10 минут):
   - Представление работ
   - Обсуждение процесса
   - Обмен впечатлениями`;
   }

   if (durationNum <= 60) {
      return `1. Творческая разминка (15 минут):
   - Раскрепощающие упражнения
   - Настрой на творчество
   - Групповая импровизация
   - Исследование материалов

2. Основной творческий процесс (35 минут):
   - Индивидуальная работа
   - Парная или групповая работа
   - Эксперименты с техниками
   - Создание творческого продукта

3. Презентация и рефлексия (10 минут):
   - Выставка/показ работ
   - Обсуждение процесса
   - Обмен впечатлениями
   - Планы на будущее`;
   }

   return `1. Творческая разминка (20 минут):
   - Раскрепощающие упражнения
   - Настрой на творчество
   - Групповая импровизация
   - Исследование материалов
   - Мини-мастер-класс

2. Основной творческий процесс (55 минут):
   - Индивидуальная работа
   - Парная или групповая работа
   - Эксперименты с техниками
   - Создание творческого продукта
   - Доработка и детализация

3. Презентация и рефлексия (15 минут):
   - Оформление выставки/показа
   - Презентация работ
   - Обсуждение процесса
   - Обмен впечатлениями
   - Планы на будущее`;
}

/**
 * Возвращает структуру внеурочного мероприятия в зависимости от длительности
 * @param {number} duration - Длительность мероприятия в минутах
 * @returns {string} Структура внеурочного мероприятия в текстовом формате
 */
export function getExtracurricularEventStructure(duration) {
   const durationNum = Number(duration);

   if (durationNum <= 30) {
      return `1. Мотивационный этап (5 минут):
   - Введение в тему
   - Постановка задачи
   - Формирование интереса

2. Практический этап (20 минут):
   - Интерактивная деятельность
   - Применение знаний
   - Развитие навыков

3. Рефлексия (5 минут):
   - Обсуждение результатов
   - Самооценка
   - Планирование развития`;
   }

   if (durationNum <= 45) {
      return `1. Мотивационный этап (10 минут):
   - Введение в тему
   - Постановка задачи
   - Формирование интереса
   - Активизация знаний

2. Практический этап (25 минут):
   - Интерактивная деятельность
   - Работа в группах
   - Применение знаний
   - Развитие навыков

3. Рефлексия (10 минут):
   - Презентация результатов
   - Обсуждение
   - Самооценка
   - Планирование развития`;
   }

   return `1. Мотивационный этап (15 минут):
   - Введение в тему
   - Постановка задачи
   - Формирование интереса
   - Активизация знаний
   - Целеполагание

2. Практический этап (35 минут):
   - Интерактивная деятельность
   - Работа в группах
   - Применение знаний
   - Развитие навыков
   - Решение кейсов

3. Рефлексия (10 минут):
   - Презентация результатов
   - Обсуждение
   - Самооценка
   - Обратная связь
   - Планирование развития`;
}

/**
 * Возвращает структуру образовательного проекта в зависимости от длительности
 * @param {number} duration - Длительность проекта в минутах
 * @returns {string} Структура образовательного проекта в текстовом формате
 */
export function getEducationalProjectStructure(duration) {
   const durationNum = Number(duration);

   if (durationNum <= 30) {
      return `1. Подготовительный этап (5 минут):
   - Постановка проблемы
   - Формирование групп
   - Распределение ролей

2. Проектный этап (20 минут):
   - Исследование
   - Разработка решения
   - Создание продукта

3. Презентационный этап (5 минут):
   - Представление результатов
   - Анализ работы
   - Планирование развития`;
   }

   if (durationNum <= 45) {
      return `1. Подготовительный этап (10 минут):
   - Постановка проблемы
   - Формирование групп
   - Распределение ролей
   - Планирование работы

2. Проектный этап (25 минут):
   - Исследование
   - Анализ информации
   - Разработка решения
   - Создание продукта

3. Презентационный этап (10 минут):
   - Представление результатов
   - Взаимооценка
   - Анализ работы
   - Планирование развития`;
   }

   return `1. Подготовительный этап (15 минут):
   - Постановка проблемы
   - Формирование групп
   - Распределение ролей
   - Планирование работы
   - Определение ресурсов

2. Проектный этап (35 минут):
   - Исследование
   - Анализ информации
   - Выдвижение гипотез
   - Разработка решения
   - Создание продукта
   - Тестирование

3. Презентационный этап (10 минут):
   - Представление результатов
   - Защита проекта
   - Взаимооценка
   - Анализ работы
   - Планирование развития`;
} 